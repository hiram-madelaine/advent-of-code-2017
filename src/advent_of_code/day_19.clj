(ns advent-of-code.day-19
  "Somehow, a network packet got lost and ended up here.
   It's trying to follow a routing diagram (your puzzle input), but it's confused about where to go.
   Its starting point is just off the top of the diagram.
   Lines (drawn with |, -, and +) show the path it needs to take,
   starting by going down onto the only line connected to the top of the diagram.
   It needs to follow this path until it reaches the end
   (located somewhere within the diagram) and stop there.
   Sometimes, the lines cross over each other;
   - in these cases, it needs to continue going the same direction,
   - and only turn left or right when there's no other option.

   In addition, someone has left letters on the line;
   - these also don't change its direction,
   - but it can use them to keep track of where it's been"
  (:require [clojure.string :as string]))

(defn ->model
  [input]
  (->> (string/split-lines input)
       (mapv vec)))

(defn init-state
  "starting by going down onto the only line connected to the top of the diagram."
  [maze]
  (let [sign \|
        x 0
        y (-> maze (get x) (.indexOf sign))]
    {:position [x y]
     :sign     sign
     :heading  :down}))


(defn add
  [from direction]
  (let [[x y] from
        [dx dy] direction]
    [(+ x dx) (+ y dy)]))

(defn diff
  [from to]
  (let [[x y] from
        [x' y'] to]
    [(- x' x) (- y' y)]))

(def moves->coords
  {:up    [-1 0]
   :down  [1 0]
   :right [0 1]
   :left  [0 -1]})

(def coords->moves (clojure.set/map-invert moves->coords))

(def headings (set (keys moves->coords)))

(def opposites (into {} (for [[heading coord] moves->coords]
                          [heading (coords->moves (map - coord))])))

(defn dead-end?
  [char]
  (contains? #{\space nil} char))

(defn find-next
  "Infer the next heading by
   finding the non empty position in all direction expect the opposite of the incoming"
  [maze position incoming-heading]
  (->> incoming-heading
       opposites
       (disj headings)
       (map moves->coords)
       (map #(add position %))
       (remove #(dead-end? (get-in maze %)))
       first
       (diff position)
       coords->moves))


(defn move
  [maze state]
  (let [{:keys [heading position]} state
        next-pos (add position (moves->coords heading))
        next-sign (get-in maze next-pos)
        next-heading (if (= \+ next-sign) (find-next maze next-pos heading) heading)]
    {:position next-pos
     :sign     next-sign
     :heading  next-heading}))

(defn base-solution [input]
  (let [maze (->model input)
        state (init-state maze)
        move (partial move maze)]
    (take-while #(not (dead-end? (:sign %))) (iterate move state))))

(defn solution-1
  [input]
  (->> (base-solution input)
       (map :sign)
       (filter #(Character/isLetter %))
       (string/join)))

(defn solution-2
  [input]
  (count (base-solution input)))

(def example "     |          \n     |  +--+    \n     A  |  C    \n F---|----E|--+ \n     |  |  |  D \n     +B-+  +--+ \n\n")

(def input-day-19 "                                                                                                                                                                   |                                     \n                                         +-----------------------+                         +-------------------------------------------------------------------------------------------+                 \n                                         |                       |                         |                                                                       |                   |                 \n                     +-------------------|-----------------------|-----------------------+ +-----------------------------------------------------------------------|-----+             |                 \n                     |                   |                       |                       |                                                                         |     |             |                 \n         +-----------+                   |             +---------------------------------|-------------------------+                                               |     |             |                 \n         |                               |             |         |                       |                         |                                               |     |             |                 \n         |         +-----+               |             |         |                       |   +---------------------|---------------------------------------+       |     |             |                 \n         |         |     |               |             |         |                       |   |                     |                                       |       |     |             |                 \n         |         |     |               |         +---|-------+ +---------------------------|---------------------------------------------------------------------|-----|-------------+                 \n         |         |     |               |         |   |       |                         |   |                     |                                       |       |     |                               \n +-------|-------------------------------|-+   +-+ |   |       |       +---------------------+                     +-+                                     | +-----------------------+ +-------------+   \n |       |         |     |               | |   | | |   |       |       |                 |                           |                                     | |     |     |           | |             |   \n |   +---|---------|-----------------------|---|---|---|---------------|-----------------+                           |                                     | |     |     |           | |             |   \n |   |   |         |     |               | |   | | |   |       |       |                                             |                                     | |     |     |           | |             |   \n |   |   |       +-|-----+               | |   | | |   |       |       |                                             +-------------------------------------|-----------------------------------------|-+ \n |   |   |       | |                     | |   | | |   |       |       |                                                                                   | |     |     |           | |             | | \n |   +-------------|-----------------------|---|---|----Y------|-------|-----------------------------------------------------------+                       | |     |     |           | |             | | \n |       |       | |                     | |   | | |   |       |       |                                                           |                       | |     |     |           | |             | | \n |       |       | |                     | |   | | |   |       |       |                         +-----------------------------------------------------------|-----|-------------------|-+           | | \n |       |       | |                     | |   | | |   |       |       |                         |                                 |                       | |     |     |           | | |           | | \n |       |     +---------------------------|-----------|---------------|-------------------------------------------------------------------------------------|-----------------+     | | |           | | \n |       |     | | |                     | |   | | |   |       |       |                         |                                 |                       | |     |     |     |     | | |           | | \n |       |     | | |                     | |   | | |   |       |       |                         | +---------------------------+   |                       | |     |     |     |     | | |           | | \n |       |     | | |                     | |   | | |   |       |       |                         | |                           |   |                       | |     |     |     |     | | |           | | \n +-+     |     | | |                     | |   | | |   |       |       |     +-+         +-------------------------------------|-----------------------------------|-----+     |     +-----+         | | \n   |     |     | | |                     | |   | | |   |       |       |     | |         |       | |                           |   |                       | |     |           |       | | |         | | \n   |     |     | | |                     | |   | | |   |       |       |     | |         |       | |                           |   |                       | |     |           |       | | |         | | \n   |     |     | | |                     | |   | | |   |       |       |     | |         |       | |                           |   |                       | |     |           |       | | |         | | \n   |     |     | | |                   +-|-|-------------------|-------------|-|---------|---+   | |                           |   |                       | |     |           |       | | |         | | \n   |     |     | | |                   | | |   | | |   |       |       |     | |         |   |   | |                           |   |                       | |     |           |       | | |         | | \n   |     |     +---|-+                 | | |   | | |   | +-----|-------------|-----------|---|-------------------------------------------------------------|-|-----|-----------|-------|-|---+       | | \n   |     |       | | |                 | | |   | | |   | |     |       |     | |         |   |   | |                           |   |                       | |     |           |       | | | |       | | \n   |     |     +-|---|---+             | | |   | | |   | |     +-------|-----|-|---------|-------|-|-----+                     |   |                       | |     |           |       | | +-|---+   | | \n   |     |     | | | |   |             | | |   | | |   | |             |     | |         |   |   | |     |                     |   |                       | |     |           |       | |   |   |   | | \n   |     |     | | | |   |             | | |   | | |   | |           +-|---+ | +---------|---|-----|-------------------------------|-----------------------|-----------+     +-|-------|-|---+   |   | | \n   |     |     | | | |   |             | | |   | | |   | |           | |   | |           |   |   | |     |                     |   |                       | |     |   |     | |       | |       |   | | \n   |     |     | | | | +-|---------------|-------|-----|-------------|-----|---------+   |   | +-|---+   | +-------------------+   |     +-------------------|---------|-+   | |       | |       |   | | \n   |     |     | | | | | |             | | |   | | |   | |           | |   | |       |   |   | | | | |   | |                       |     |                 | |     |   | |   | |       | |       |   | | \n   |     | +-------+ | | |             | | |   | | |   | |           | |   | |       |   |   | | | | |   | |                       |     |                 | |     |   | |   | +-------|---+     |   | | \n   |     | |   | |   | | |             | | |   | | |   | |           | |   | |       |   |   | | | | |   | |                       |     |                 | |     |   | |   |         | | |     |   | | \n   |     | |   | |   | | |             | +-|---|-|-------|-----------|-----|---------|-------|-------|-+ | |   +-+                 |     |                 | |     +-----------+       | | |   +-+   | | \n   |     | |   | |   | | |             |   |   | | |   | |           | |   | |       |   |   | | | | | | | |   | |                 |     |                 | |         | |   | |       | | |   |     | | \n   |     | |   | |   | | |             |   |   | | |   | |           | |   | +-----------------|---|---|-|---+ | +-----------------------|-------+   +-+   | |       +-|-|---|-|-------|-+ |   | +-+ | | \n   |     | |   | |   | | |             |   |   | | |   | |           | |   |         |   |   | | | | | | | | | |                   |     |       |   | |   | |       | | |   | |       |   |   | | | | | \n   |     | |   | |   | | |             |   |   +---|-----|-------------|---|-+   +-------|---------+ | | | | | |                   |     |       |   | |   | |       | | |   | |       |   |   +-+ | | | \n   |     | |   | |   | | |             |   |     | |   | |           | |   | |   |   |   |   | | |   | | | | | |                   |     |       |   | |   | |       | | |   | |       |   |       | | | \n   |   +-|-|-----|---|-|-|-------------------------------------------|-----|-|-------+   |   | | | +-----|---|---------+           |     | +-----------|---------+   | | |   | |       |   |       | | | \n   |   | | |   | |   | | |             |   |     | |   | |           | |   | |   |       |   | | | | | | | | | |       |           |     | |     |   | |   | |   |   | | |   | |       |   |       | | | \n +-|---|-|-|-+ | +---|---|-------------------------+   | |           | |   | +---|-------|---|-+ +-|-|---|-|-----------|-----------|-----|-|-----|---|-|-----+   | +---|-----|---+     |   |       | | | \n | |   | | | | |     | | |             |   |     |     | |           | |   |     |       |   |     | | | | | | |       |           |     | |     |   | |   |     | | | | |   | | |     |   |       | | | \n | |   | | | | | +-----|-------------------+     |     | |           | +---|---------+   |   |     | | | | | | |       |         +-------|-|-----|-----|-------+ | | | +-+   | | |     |   |       | | | \n | |   | | | | | |   | | |             |         |     | |           |     |     |   |   |   |     | | | | | | |       |         | |     | |     |   | |   |   | | | |       | | |     |   |       | | | \n | |   | | | | | |   | | | +---------------------|-+   | |           |     |     |   | +-----|---+ | | | | | | |       |         | |     | |     |   | |   |   | | | |       | | |     |   |       | | | \n | |   | | | | | |   | | | |           |         | |   | |           |     |     |   | | |   |   | | | | | | | |       |         | |     | |     |   | |   |   | | | |       | | |     |   |       | | | \n | |   | | | | | |   | | | |           |         | |   | |           |     |     | +-|-|-----|---|---|-|-|-|-|-------------------+ |     | |     |   | |   |   | | +-|-----+ | | |     |   |       | | | \n | |   | | | | | |   | | | |           |         | |   | |           |     |     | | | | |   |   | | | | | | | |       |           |     | |     |   | |   |   | |   |     | | | |     |   |       | | | \n | |   | | | | +-|---|---------------------------|-------------+     |     +---+ | | | | |   |   | | | | | | | | +-----|-----------|-----|-------|---|---+ |   | |   |     | | | |     |   |       | | | \n | |   | | | |   |   | | | |           |         | |   | |     |     |         | | | | | |   |   | | | | | | | | |     |           |     | |     |   | | | |   | |   |     | | | |     |   |       | | | \n | |   | | +---------|-|-|-----------------------|-|-----------|---------------|-----|---|---------|---|-|---|-|-|-----|-----------|-------|---+ |   | | | |   | |   |     | | | |     |   |       | | | \n | |   | |   |   |   | | | |           |         | |   | |     |     |         | | | | | |   |   | | | | | | | | |     |           |     | |   | |   E | | |   | |   |     | | | |     |   |       | | | \n | |   | |   |   |   | | | |     +-----|-----------|---|---------------------+ | | | | | |   |   | | | | | | | | |     |           |     | |   | |   | | | |   +-|---|-+   | | | |     |   |       | | | \n | |   | |   |   |   | | | |     |     |         | |   | |     |     |       | | | | | | |   |   | | | | | | | | |     |           |     | |   | |   | | | |     |   | |   | | | |     |   |       | | | \n | |   +-|-------------|-|-|-----|----------U----|-|---|-------|-------------|-|-|---|---+   |   | | | | | | | | |     |           |     | |   | |   | | | |     |   | |   | | | |     |   |       | | | \n | |     |   |   |   | | | |     |     |         | |   | |     |     |       | | | | | |     |   | | | | | | | | |     |           |     | |   | |   | | | |     |   | |   | | | |     |   |       | | | \n | |     |   |   |   | | | |     +---------------|---------------------------|-----|---------|-----|-------------|-----------------+     | |   | |   | | | |     | +-+ | +-|---|-----------------+ | | | \n | |     |   |   |   | | | |           |         | |   | |     |     |       | | | | | |     |   | | | | | | | | |     |                 | |   | |   | | | |     | |   | | | | | |     |   |     | | | | \n | |     | +-|-----+ | +-|-+     +---------------|-|---+ |     |     |       | | | | | |     |   | | | | | | | +-------|-----------------------|-|---|---|-|-----|---------|-|---------|---------+ T | | \n | |     | | |   | | |   |       |     |         | |     |     |     |       | | | | | |     |   | | | | | | |   |     |                 | |   | |   | | | |     | |   | | | | | |     |   |         | | \n | |     | | |   | | |   |       |     |         | |     |     |     |       | | | | | |     |   | | | | | | |   |     |                 | |   | |   | | | |     | |   | | | | | | +-------------+   | | \n | |     | | |   | | |   |       |     |         | |     |     |     |       | | | | | |     |   | | | | | | |   |     |                 | |   | |   | | | |     | |   | | | | | | |   |   |     |   | | \n | |     | | |   | | | +-----------------------+ | |     |     |     |     +---+ | | +-|-----|---|-|-|-+ | | |   |     |         +-------|---+ +-+ +-|-|-+ |     | +---+ | | | | | |   |   |     |   | | \n | |     | | |   | | | | |       |     |       | | |     |     |     |     | |   | |   |     |   | | |   | | |   |     |         |       | | |     | | |   |     |       | | | | | |   |   |     |   | | \n | |     | | |   | | +-----------|-----|-----------|-----|-----|-----------------|-|---|-------------|---|---|---|-----|---------|---------|-------|-----------+ |     +---|-|-|-|-|---|---|-----+   | | \n | |     | | |   | |   | |       |     |       | | |     |     |     |     | |   | |   |     |   | | |   | | |   |     |         |       | | |     | | |   |   | |     | | | | | | |   |   |         | | \n | |     | | |   | |   | |     +---+   |       | | |     |   +-|-----|-----|-------|---------|-+ | | |   | | +---|-----|---------|---------|-------------+ |   | | +-----------|---|-------|-----+   | | \n | |     | | |   | |   | |     | | |   |       | | |     |   | |     |     | |   | |   |     | | | | |   | |     |     |         |       | | |     | | | | |   | | |   | | | | | | |   |   |     |   | | \n +---------|-----|-|-----|-------|-|-----------|-|-|-----|---|-------|-------|---|-|--D------|-|---|-------------|---------+     |     +-------------|-|-----------------|-|---|-|-|-------|-------+ | | \n   |     | | |   | |   | |     | | |   |       | | |     |   | |     |     | |   | |   |     | | | | |   | |     |     |   |     |     | | | |     | | | | |   | | |   | | | | | | |   |   |     | | | | \n   |     | | |   | |   | |     | | |   |       | | |     |   | |     | +---------|---+ +-------|---|-------+     |     |   |     |     | | | |     | | | | |   | | +---|---------|---+ |   |     | | | | \n   |     | | |   | |   | |     | | |   |       | | |     |   | |     | |   | |   | | |       | | | | |   |       |     |   |     |     | | | |     | | | | |   | |     | | | | | | | | |   |     | | | | \n   |     | | |   | |   | |     | | |   |       | | |     |   | |     | |   | |   | | |       | | | | |   |       |     +---------------|---|-|-----|-----+ |   | |     | | | | | | | | |   |     | | | | \n   |     | | |   | |   | |     | | |   |       | | |     |   | |     | |   | |   | | |       | | | | |   |       |         |     |     | | | |     | | |   |   | |     | | | | | | | | |   |     | | | | \n   |     | | |   | |   | |     | | |   |       | | |     |   | |     | |   | |   | | |       | | | | |   | +-------+ +-+   |   +-|-----|-----|-----|-|-|-------|-|-------|-|-|-|---+ | |   |     +-+ | | \n   |     | | |   | |   | |     | | |   |       | | |     |   | |     | |   | |   | | |       | | | | |   | |     | | | |   |   | |     | | | |     | | |   |   | |     | | | | | |   | |   |         | | \n   |     | | |   | | +-|-------|-------|-----------------------------------|-+   | | |       | | | | |   | |     | | | +---------------|---|-|-----|-|-|-------|-|-------+ | | | | +-|-|---|-+   +-+ | | \n   |     | | |   | | | | |     | | |   |       | | |     |   | |     | |   |     | | |       | | | | |   | |     | | |     |   | |     | | | |     | | |   |   | |     |   | | | | | | |   | |   | | | | \n   |     | | |   | | | | |     | | |   |       | | |     |   | | +---|-|---------|-|---------|-|---|-|-----|-----|-|-|-----+ +---------+ | | |     | | |   |   | |     +---|-|-|-|-+ | |   | +-----+ | | \n   |     | | |   | | | | |     | | |   |       | | |     |   | | |   | |   |     | | |       | | | | |   | |     | | |       | | |       | | |     | | |   |   | |         | | | |   | |   |     |   | | \n   |     | | |   | | | | |     | | |   |       +-------------|-|-----------------|-----------|-|-----|-----|-----|-|-----+   | | |       | | |     | | |   |   | |         | | | |   | |   |     |   | | \n   |     | | |   | | | | |     | | |   |         | |     |   | | |   | |   |     | | |       | | | | |   | |     | | |   |   | | |       | | |     | | |   |   | |         | | | |   | |   |     |   | | \n   |     | | |   | | | | | +-----|-|-----+       | |     |   | | |   | |   |     | | |       | | | | |   | |     | | |   |   | | |       | | |     | | |   |   | |         | | | +---------|---+ |   | | \n   |     | | |   | | | | | |   | | |   | |       | |     |   | | |   | |   |     | | |       | | | | |   | |     | | |   |   | | |       | | |     | | |   |   | |         | | |     | |   |   | |   | | \n   |     | | |   | | | | | |   | | |   | |       | |     |   | | |   | |   |     | | |       | | | | |   | |     | | |   |   | | |       | | |     | | |   |   | |         | | |     | |   |   +-|-+ | | \n   |     | | |   | | | | | |   | | |   | |       | |     |   | | |   | |   |     | I |       | | | | |   | |     | | |   |   | | |       | | |     | | |   |   | |         | | |     | |   |     | | | | \n   |     | | | +-|---------|-----|---------------------------+ | |   | |   |     | | |       | | | | |   | |   +-|-------+   | | |       | | |     | | |   |   | |         | | |     | |   | +-+ | | | | \n   |     | | | | | | | | | |   | | |   | |       | |     |     | |   | |   |     | | |       | | | | |   | |   | | | |       | | |       | | |     | | |   |   | |         | | |     | |   | | | | | | | \n   |     +-|---|-------|---|-----|-|-----|---------------|-----|-----|-----------|---|-----------|-|-----|-----|---------------|---------|-|-|-+   | | | +-------|-------+ | | |     | |   | | | | | | | \n   |       | | | | | | | | |   | | |   | |       | |     |     | |   | |   |     | | |       | | | | |   | |   | | | |       | | |       | | | |   | | | | |   | |       | | | |     | |   | | | | | | | \n   |       | | +---|-|-+ +---------+   | |       +-------|-----|-----|---------------------+ | | | | |   | |   | | | |       | | |       | | | |   | | | | |   | |       | | | |     | |   | | | | | | | \n   |       | |   | | |     |   | |     | |         |     |     | |   | |   |     | | |     | | | | | |   | |   | | | |       | | |       | | | |   | | | | |   | |       | | | |     | |   | | | | | | | \n +-|-------|---+ | | |     |   | |     | |   +-----------------|-|---------------|---+     | | | | | |   | +---|---|-----------|-|---+   | | | |   | | | | |   | |       | | | |     | |   | | | | | | | \n | |       | | | | | |     |   | |     | |   |     |     |     | |   | |   |     | |       | | | | | |   |     | | | |       | | |   |   | | | |   | | | | |   | |       | | | |     | |   | | | | | | | \n | |       | | | | | |     |   | |     | |   |     |     |     | |   | |   |     | |       | | | | | |   |     | | | | +-+   | | |   |   | | | |   | | | | |   | |       | | | |     | |   | | | | | | | \n | |       | | | | | |     |   | |     | |   |     |     |     | |   | |   |     | |       | | | | | |   |     | | | | | |   | | |   |   | | | |   | | | | |   | |       | | | |     | |   | | | | | | | \n | |       | | | | | |     |   | |     | |   |     |     |   +---|---|-|-------------------------|-+ |   |     | | | | | |   | | |   |   | | | |   | | | | |   | |       | | | |     | |   | | | | | | | \n | |       | | | | | |     |   | |     | |   |     |     |   | | |   | |   |     | |       | | | |   |   |     | | | | | |   | | |   |   | | | |   | | | | |   | |       | | | |     | |   | | | | | | | \n +-|-------|---|-----|-----|-----------|-------------------------|---|-+   |     | |       | | | |   |   |     | | | | | |   | | |   +-----|-----------|---|---|---+     | | | |     | |   | | | | | | | \n   |       | | | | | |     |   | |     | |   |     |     |   | | |   |     |     | |       | | | |   |   |     | | | | | |   | | |       | | | |   | | | | |   | | |     | | | |     | |   | | | | | | | \n +-------------|-|-|-------|-----|-------|---------|---------|-------------------|-|---------+ +-|---|-----+   | | | | | |   | | |       | | | |   | | | | |   | | |     | | | |     | |   | | | | | | | \n | |       | | | | | |     |   | |     | |   |     |     |   | | |   |     |     | |       |     |   |   | |   | | | | | |   | | |       | | | |   | | | | |   | | |     | | | |     | |   | | | | | | | \n +-|-------------|---------|---|-|-----|-|-------------------|-|-----|-----|---------+     |     |   |   | |   | | | | | |   | | |       | | | |   | | | | |   | | |     | | | |     | |   | | | | | | | \n   |       | | | | | |     |   | |     | |   |     |     |   | | |   |     |     | | |     |     |   |   | |   | | | | | |   | | |       | | | |   | | | | |   | | |     | | | |     | |   | | | | | | | \n   |       | | | | | |     | +-----------|---|---+ |     |   | | |   |     |     | | |     |     |   |   | |   | | | | | |   | | |       | | | |   | | | | |   | | |     | | | |     | |   | | | | | | | \n   |       | | | | | |     | | | |     | |   |   | |     |   | | |   |     |     | | |     |     |   |   | |   | | | | | |   | | |       | | | |   | | | | |   | | |     | | | |     | |   | | | | | | | \n   |       | | | | | |     | | | |     +-----|---|-----------|-|-|---------|-----|-|-------------|---|-------+ | | | | | |   | | |       | | | |   | | | | |   | | +---------|-|-----------|---|-+ | | | \n   |       | | | | | |     | | | |       |   |   | |     |   | | |   |     |     | | |     |     |   |   | | | | | | | | |   | | |       | | | |   | | | | |   | |       | | | |     | |   | | |   | | | \n   |       | | | | | |     | | | |       +---------|-----|---|-|-----|-----|-----|-|-|-----|-+   |   |   | | | | | | | | |   | | |       | | | |   | | | | |   | |       | | | |     | |   | | |   | | | \n   |       | | | | | |     | | | |           |   | |     |   | | |   |     |     | | |     | |   |   |   | | | | | | | | |   | | |       | | | |   | | | | |   | |       | | | |     | |   | | |   | | | \n   |       | | | | | |     | | | |           |   | |     |   | | |   |     |     | | |     | |   |   | +-|-|---|---|---|-------|-----------|-|-+ +-|-|-----+   | |       | | | |     | |   | | |   | | | \n   |       | | | | | |     | | | |           |   | |     |   | | |   |     |     | | |     | |   |   | | | | | | | | | | |   | | |       | | |   | | | | |     | |       | | | |     | |   | | |   | | | \n   |       | | | | | +-----|-|-+ |           |   | |     |   | | |   +-----------|---|-----|-|-------|-|---|-|N|-|-----|-------|-|-----------|---|-|-----|-+   | |       | | | |     | |   | | |   | | | \n   |       | | | | |       | |   |           |   | |     |   | | |         |     | | |     | |   |   | | | | | | | | | | |   | | |       | | |   | | | | | |   | |       | | | |     | |   | | |   | | | \n   |       | | +-|-|-------|-|---|-------+   |   | |     |   | | |         |     | | |     | |   |   | | | | | | | | | | |   | | |       | | |   | | | | | +-----+       | | | |     | |   | | |   | | | \n   |       | |   | |       | |   |       |   |   | |     |   | | |         |     | | |     | |   |   | | | | | | | | | | |   | | |       | | |   | | | | |     |         | | | |     | |   | | |   | | | \n   |       | |   | |       | |   |       |   |   | |     |   | | |         |     | | |     | |   |   | | | | | | | | | | |   | | |       +---|-------|---|-+   |         | | | |     | |   | | |   | | | \n   |       | |   | |       | |   |       |   |   | |     |   | | |         |     | | |     | |   |   | | | | | | | | | | |   | | |         | |   | | | | | |   |         | | | |     | |   | | |   | | | \n   |       | |   | |       | |   |       |   |   | |     |   | | |         |     +---|-----|-----------|-|-|-|-----|-|---|---|-+ |         | |   | | | | | |   |         +-|-|-|-+   | |   | | |   | | | \n   |       | |   | |       | |   |       |   |   | |     |   | | |         |       | |     | |   |   | | | | | | | | | | |   |   |         | |   | | | | | |   |           | | | |   | |   | | |   | | | \n   |       | |   | |       | |   |       |   |   | |     |   | | |         |       | |     | |   |   | | | | | | | | | | |   |   |         | |   | | | | | |   |           | | | |   | |   | | |   | | | \n   |       | |   | |       | |   |       |   |   | |     |   | | |         |       | |     | |   |   | | | | | | | | | | |   |   |         | |   | | | | | |   |           | | | |   | |   | | |   | | | \n   |       | |   | |       | |   |       |   |   | |     |   | | |         |       | |     | |   |   | | | | | | | | | | |   |   |         | |   | | | | | |   |           | | | |   | |   | | |   | | | \n   |       | |   | |       | |   |       |   |   | |     |   | | |         |       | |     | |   |   | | | | | | | | | | |   |   |         | |   | | | | | |   |           | | | |   | |   | | |   | | | \n   |       | |   | |   +---+ +---|-------|---------------|---|---|-------------------|-------------------|-|---|-|-|---|-|-------------------|-----|-----|-|---|---+       | | | |   | |   | | |   | | | \n   |       | |   | |   |         |       |   |   | |     |   | | |         |       | |     | |   |   | | | | | | | | | | |   |   |         | |   | | | | | |   |   |       | | | |   | |   | | |   | | | \n   |       | |   | |   |         |       |   |   | |     |   | | |         |       | |     | |   |   | | | | | | | | | | |   |   |         | |   | | | | | |   |   |       | | | |   | |   | | |   | | | \n   |       | |   | |   |         |       |   |   | |     |   | | |         |       | |     | |   |   | | | | | | | | | | |   |   |         | |   | | | | | |   |   |       | | | |   | |   | | |   | | | \n   |       +-----|---------------|-----------|---|-------|-----------------|-------|-------|-----------|-------|-+ | | | |   |   |         | |   | | | | | |   |   |       | | | |   | |   | | |   | | | \n   |         |   | |   |         |       |   |   | |     |   | | |         |       | |     | |   |   | | | | | |   | | | |   |   |         | |   | | | | | |   |   |       | | | |   | |   | | |   | | | \n   |         |   | |   |         |       |   |   | |   +-|---|---|-------------------|-----|-----|-----|-|-|-|-----------+   |   |         | |   | | | +-|-|---+   |       | | | |   | |   | | |   | | | \n   |         |   | |   |         |       |   |   | |   | |   | | |         |       | |     | |   |   | | | | | |   | | |     |   |         | |   | | |   | |       |       | | | |   | |   | | |   | | | \n   |       +-----|---------------|-------|---|---+ |   | |   | | |         | +-----|-|-----|-|---|---|---|-|-|---------|---------|---------|---------+   | +-----------+   | | | |   | |   | | |   | | | \n   |       | |   | |   |         |       |   |     |   | |   | | |         | |     | |     | |   |   | | | | | |   | | |     |   |         | |   | |     |         |   |   | | | |   | |   | | |   | | | \n   |       | |   | |   |         |       |   |     |   | |   | | |         | |     | |     | |   |   | | | | | |   | | |     |   |         | |   +-|---------------|---|---|---|-|---------|-|---+ | | | \n   |       | |   | |   |         |       |   |     |   | |   | | |         | |     | |     | |   |   | | | | | |   | | |     |   |         | |     |     |         |   |   | | | |   | |   | | | | | | | \n   |       | |   | |   |         |       |   |     |   | |   | | |         | |     | |     | |   +-------|-|-|-------|-------|---|---------|-------|-----------+ +-|---+   | | | |   | |   | | | | | | | \n   |       | |   | |   |         |       |   |     |   | |   | | |         | |     | |     | |       | | | | | |   | | |     |   |         | |     |     |     | | |       | | | |   | |   | | | | | | | \n   |       | |   | |   |         |       |   |     |   | |   | | |         | |     | +-------|---------|-----|---------|---------------------|-----|-----------|-|-----------|-+ |   | |   | | | | | | | \n   |       | |   | |   |         |       |   |     |   | |   | | |         | |     |       | |       | | | | | |   | | |     |   |         | |     |     |     | | X       | |   |   | |   | | | | | | | \n   |       | |   | |   |         |       |   |   +-----|-----|-|-|---------+ |     | +-----------+   | | | | | |   | | |     |   |         | |     |     | +-----------+ +-|---+ |   +-|-------|-+ | | | \n   |       | |   | |   |         |       |   |   | |   | |   | | |           |     | |     | |   |   | | | | | |   | | |     |   |         | |     |     | |   | | |   | | | | | |     |   | | |   | | | \n   |       | |   | |   |         |       |   |   | |   | |   | | +-----------------|-|---+ | |   |   +-------|-|-------------|-------------|-----+ |     | |   | +-|---|-----|-+ |     |   | | |   | | | \n   |       | |   | |   |         |       |   |   | |   | |   | |             |     | |   | | |   |     | | | | |   | | |     |   |         | |   | |     | |   |   |   | | | |   |     |   | | |   | | | \n +---------|-----------|-----------------|---|---|-----|-+   | |             |     | |   | | |   +-----|-|-|---|-------|-----|---------------|-----|-----|-|---|-----------|-----|---------|-----+ | | | \n | |       | |   | |   |         |       |   |   | |   |     | |             |     | |   | | |         | | | | |   | | |     |   |         | |   | |     | |   |   |   | | | |   |     |   | | | | | | | \n | +---+   | |   | |   |   +---------------------|-----|-----|-|-------------|-----|-----|-|-----------|-|-|-|-|---|-------------|---------|-----+ |   +-----------|---------|---|-----|-----|-|---|-+ | \n |     |   | |   | |   |   |     |       |   |   | |   |     | |             |     | |   | | |         | | | | |   | | |     |   |         | |     |   | | |   |   |   | | | |   |     |   | | | | |   | \n |     | +---|---|-----|---|-----|-------|-------|-----------|---------------------------|-|-|---------------------|-|-|---------------------|---+ |   | | |   |   |   | | | |   |     |   | | | | |   | \n |     | | | |   | |   |   |     |       |   |   | |   |     | |             |     | |   | | |         | | | | |   | | |     |   |         | |   | |   | | |   |   |   | | | |   |     |   | | | | |   | \n |     | | | |   | |   |   |     |       |   |   | |   |     | |             +-------|-----|-----------------+ | +-+ | |     |   |         | |   | |   +-|-|---|-+ |   | | | |   |     |   | | | | |   | \n |     | | | |   | |   |   |     |       |   |   | |   |     | |                   | |   | | |         | | |   | |   | |     |   |         | |   | |     | |   | | |   | | | |   |     |   | | | | |   | \n |     | | | | +-|-----|---+     |       |   |   | |   |     | |                   | | +-|-|-------------|-|-----|---------+ |   |         | |   | |     | |   | | |   | | | |   |     |   | | | | |   | \n |     | | | | | | |   |         |       |   |   | |   |     | |                   | | | | | |         | | |   | |   | |   | |   |         | |   | |     | |   | | |   | | | |   |     |   | | | | |   | \n |     | | | | | | |   |         |       |   |   +-|-----+   | |                   | | | | | |         | | |   | |   | |   | |   |         | |   | |     | |   | | |   | | | |   |     |   | | | | +-+ | \n |     | | | | | | |   |         |       |   |     |   | |   | |                   | | | | | |         | | |   | |   | |   | |   |         | |   | |     | |   | | |   | | | |   |     |   | | | |   | | \n +-----|-|-|-------|---|---------|-------|---------|---|-----|-|-------------------|-------|-------------|-----|-|---------|-|---------------|---|-----------------|-------|-|---|-----------|---------+ \n       | | | | | | |   |         |       |   |     |   | |   | |                   | | | | | |         | | |   | |   | |   | |   |         | |   | |     | |   | | |   | | | |   |     |   | | | |   |   \n +---------+ | | | |   |         | +-----|---|-----|-----|---|-|-------------------------|-|-|-----------|-|-----|---------|-----|-----------------|-----|-----|-|-------|-----------------|---------+   \n |     | |   | | | |   |         | |     |   |     |   | |   | |                   | | | | | |         | | |   | |   | |   | |   |         | |   | |     | |   | | |   | | | |   |     |   | | | |       \n |     | |   | | | |   |         | |     |   |     |   | |   | |                   | +---|-|-----------|-|-|-----|---------|-----|-----------|---|-|---+ | |   | | |   | | +-----------|-+ | | | |       \n |     | |   | | | |   |         | |     |   |     |   | |   | |                   |   | | | |         | | |   | A   | |   | |   |         | |   | |   | | |   | | |   | |   |   |     | | | | | |       \n +-----|-----|-|---|-+ |         | |   +---+ +-----|---|-------------------------+ |   | | | |         +---------|---------------|-----------|-----|-+ | | |   | | |   +-|-------------|-|-|-|---|---+   \n       | |   | | | | | |         | |   | | |       |   | |   | |                 | |   | | | |           | |   | |   | |   | |   |         | |   | | | | | |   | | |     |   |   |     | | | | | |   |   \n       | |   | | | | | |         | |   | | |       |   | |   | |                 | |   +-----|-----------|-+   | |   | |   | |   |         | |   | | +-+ | |   | | | +---|---|---+     | | | | | +---+   \n       | |   | | | | | |         | |   | | |       |   | |   | |                 | |     | | |           |     | |   | |   | |   |         | |   | |     | |   | | | |   |   |         | | | | |         \n       | |   | | | | | |         +-|-----|-|-------|-----------+                 | |     | | |           |     | |   | |   | |   |         | |   | |     | |   | | | |   |   |   +-+   | | | | |         \n       | |   | | | | | |           |   | | |       |   | |   |                   | |     | | |           |     | |   | |   | |   |         | |   | |     | |   | | | |   |   |   | |   | | | | |         \n       | |   | +-----|-|-----------|-+ | | |       |   | |   |                   +-------|-|-------------|-----|-----|-----|---------------------|-|-------|---|-|---|---|---|-----|-----|---+ |         \n       | |   |   | | | |           | | | | |       |   | |   |                     |     | | |           |     | |   | |   | |   |         | |   | |     | |   | | | |   |   |   | |   | | |   |         \n       | |   |   | | | |           | | | | |       |   | |   |                 +---|---+ | | |           |     | | +-|-|---+ |   |         +-+   | |     | |   | | | |   +---|---|-|---|-------|-+       \n       | |   |   | | | |           | | | | |       |   | |   |                 |   |   | | | |           |     | | | | |     |   |               | |     | |   | | | |       |   | |   | | |   | |       \n       | |   |   | | | +-------------|-+ | |     +-|-----------------------------------+ | | |       +---|-----+ | | | |     |   |               | |     | |   | | +-|-----------+ |   | | |   | |       \n       | |   |   | | |             | |   | |     | |   | |   |                 |   |     | | |       |   |       | | | |     |   |               | |     | |   | |   |       |     |   | | |   | |       \n   +---|-|-------|-+ |             | +---|-------+ |   | |   +---------------------------|-----------|---|-------|-----|-----|---------------------------------|-------------------+   | | |   | |       \n   |   | |   |   |   |             |     | |       |   | |                     |   |     | | |       |   |       | | | |     |   |               | |     | |   | |   |       |         | | |   | |       \n   |   | |   |   |   |             |     | +-------|---+ +-------------+       +---+     +-|-|-------|-------------|-|---------------------------|-+     | |   | |   |       |         | | |   | |       \n   |   | |   |   |   |             |     |         |                   |                   | |       |   |       | | | |     |   |               |       | |   | |   |       |         | | |   | |       \n   | +-------|---+   |             |     |         |                   |                   | |       |   |       | | +-+     +-------------------|-----+ +-+   +-----|-+     |         +---+   | |       \n   | | | |   |       |             |     |         |                   |                   | |       |   |       | |             |               |     |         |   | |     |           |     | |       \n   | | | |   |       |             |     |         |             +-----|-------------------|---------|---|-------|-|---+         |               |     |         |   | |     |           |     | |       \n   | | | |   |       |             |     |         |             |     |                   | |       |   |       | |   |         |               |     |         |   | |     |           |     | |       \n +-+ +---|-----------|-----------------------------------------------------------------------|-------|-----------|-----|-----------------------------------+     |   +-------------------+   +-|-+       \n |     | |   |       |             |     |         |             |     |                   | |       |   |       | |   |         |               |     |   |     |     |     |               | P         \n |   +-------|---------+           |     |         +-------------|-------------------------|---------|---|---------|-------------|-------------------------+     |     +-----------------+   | |         \n |   | | |   |       | |           |     |                       |     |                   | |       |   |       | |   |         |               |     |         |           |           |   | |         \n |   | | |   |       | |           |     +-----------------------------|-----+             | +-------|-------------|---+         |               +-----|---+     |           |           |   | |         \n |   | | |   |       | |           |                             |     |     |             |         |   |       | |             |                     |   |     |           |           |   | |         \n |   +---+   |     +-|-------------+                             |     |     |             +---------+   +-------+ +-------------+                     +---+     |           |           +---+ |         \n |     |     |     | | |                                         |     |     |                                                                                   |           |                 |         \n +-----+     +-----+ +-+                                         +-----+     +-----------------------------------------------------------------------------------+           +-----------------+         \n                                                                                                                                                                                                         \n")

(comment

  (let [maze (->model example)
        state (init-state maze)]
    state)
  (count (base-solution example))
  (count (base-solution input-day-19))

  )
